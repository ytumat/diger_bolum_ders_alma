<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>DilekÃ§e OluÅŸtur</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: Calibri, "Times New Roman", serif;
      background-color: #f4f4f4;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 30px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      margin-bottom: 16px;
      font-size: 16px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      margin-right: 10px;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }

    table, th, td {
      border: 1px solid black;
      text-align: center;
      padding: 10px;
    }

    .letter-section {
      display: none;
      margin-top: 40px;
      padding: 40px;
      background: white;
      border: none;
    }

    .center-text {
      text-align: center;
      margin: 0;
      line-height: 1.1;
    }

    .left-text {
      text-align: justify;
      margin-top: 20px;
      white-space: pre-line;
    }

    .download-button {
      display: none;
      margin-top: 20px;
    }

    .ders-item {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 20px;
      background-color: #fafafa;
    }

    @media print {
      body * {
        visibility: hidden;
      }

      .letter-section, .letter-section * {
        visibility: visible;
      }

      .letter-section {
        position: absolute;
        top: 0;
        left: 0;
        width: 210mm;
        height: 297mm;
        background: white !important;
        padding: 40px;
        margin: 0;
        box-shadow: none !important;
        border: none !important;
      }

      .download-button {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>DiÄŸer BÃ¶lÃ¼mlerden Ders Alma DilekÃ§esi OluÅŸturma</h2>
    <form id="dilekceForm">
      <label>AdÄ±nÄ±z:</label>
      <input type="text" id="ad" required />
      <label>SoyadÄ±nÄ±z:</label>
      <input type="text" id="soyad" required />
      <label>Ã–ÄŸrenci NumarasÄ±:</label>
      <input type="text" id="numara" required />
      <label>E-posta:</label>
      <input type="email" id="email" required />
      <label>Cep Telefonu:</label>
      <input type="text" id="telefon" required />

      <label>Eklenecek Ders(ler) <strong>Dahil</strong> GÃœZ YarÄ±yÄ±lÄ±nda <strong>AlÄ±nan Toplam Kredi</strong>:</label>
      <input type="number" id="kredi" required />

      <label>Mazeretiniz:</label>
      <textarea id="mazeret" rows="3" required></textarea>

      <label>BÃ¶lÃ¼mÃ¼nÃ¼zÃ¼ SeÃ§iniz:</label>
      <select id="bolumSelect" required>
        <option value="MATEMATÄ°K BÃ–LÃœM BAÅžKANLIÄžI'NA">MATEMATÄ°K</option>
        <option value="FÄ°ZÄ°K BÃ–LÃœM BAÅžKANLIÄžI'NA">FÄ°ZÄ°K</option>
        <option value="KÄ°MYA BÃ–LÃœM BAÅžKANLIÄžI'NA">KÄ°MYA</option>
        <option value="Ä°STATÄ°STÄ°K BÃ–LÃœM BAÅžKANLIÄžI'NA">Ä°STATÄ°STÄ°K</option>
        <option value="MOLEKÃœLER BÄ°YOLOJÄ° VE GENETÄ°K BÃ–LÃœM BAÅžKANLIÄžI'NA">MOLEKÃœLER BÄ°YOLOJÄ° VE GENETÄ°K</option>
        <option value="TÃœRK DÄ°LÄ° VE EDEBÄ°YATI BÃ–LÃœM BAÅžKANLIÄžI'NA">TÃœRK DÄ°LÄ° VE EDEBÄ°YATI</option>
        <option value="BATI DÄ°LLERÄ° VE EDEBÄ°YATLARI BÃ–LÃœM BAÅžKANLIÄžI'NA">BATI DÄ°LLERÄ° VE EDEBÄ°YATLARI</option>
      </select>

      <h3>Dersler</h3>
      <div id="dersListesi"></div>
      <button type="button" onclick="dersEkle()">âž• Ders Ekle</button>

      <br><br>
      <button type="submit">DilekÃ§eyi OluÅŸtur</button>
    </form>

    <div class="letter-section" id="dilekceOutput">
      <p id="bolumYazisi" class="center-text" style="font-weight: bold; margin-bottom: 1cm;"></p>
      <div class="left-text" id="ogrenciBilgileri"></div>

      <p style="margin-top: 30px;">
        2025-2026 EÄŸitim-Ã–ÄŸretim yÄ±lÄ± GÃœZ YarÄ±yÄ±lÄ±nda aÅŸaÄŸÄ±da belirtmiÅŸ olduÄŸum mazeretten dolayÄ± Ã¼niversitemiz diÄŸer bÃ¶lÃ¼mlerinden almak istediÄŸim aÅŸaÄŸÄ±daki ders(ler)in Ã¶ÄŸrenci otomasyon sistemine iÅŸlenmesi iÃ§in gereÄŸini arz ederim.
      </p>

      <p style="margin-top: 10px;"><strong>Mazeret:</strong> <span id="mazeretMetni"></span></p>

      <table id="dersTablosu">
        <thead>
          <tr>
            <th colspan="5">AlÄ±nacak Dersin</th>
            <th colspan="3">BÃ¶lÃ¼mÃ¼mÃ¼zde EÅŸdeÄŸer OlduÄŸu Dersin</th>
          </tr>
          <tr>
            <th>BÃ¶lÃ¼mÃ¼</th>
            <th>Kodu-AdÄ±</th>
            <th>Grubu</th>
            <th>Dili</th>
            <th>Kredisi (T+U)</th>
            <th>Kodu-AdÄ±</th>
            <th>Dili</th>
            <th>Kredisi (T+U)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <p style="margin-top: 20px;"><strong>Eklenecek Ders(ler) Dahil GÃœZ YarÄ±yÄ±lÄ±nda AlÄ±nan Toplam Kredi:</strong> <span id="krediBilgisi"></span></p>
      <br><br>
      <p style="text-align: right;" id="tarihYeri"></p>
      <p style="text-align: right;" id="imzaAlani">Ä°mza: _________</p>
    </div>

    <div class="download-button" id="downloadBtnDiv">
      <button id="downloadBtn">ðŸ“¥ PDF Olarak Ä°ndir</button>
    </div>
  </div>

  <script>
    function formatDersAdi(dersAdi) {
      if (!dersAdi) return "";
      const firstThree = dersAdi.slice(0, 3).toUpperCase();
      const rest = dersAdi.slice(3);

      const turkishToLower = (str) =>
        str
          .replace(/Ä°/g, "i")
          .replace(/I/g, "Ä±")
          .replace(/Åž/g, "ÅŸ")
          .replace(/Äž/g, "ÄŸ")
          .replace(/Ãœ/g, "Ã¼")
          .replace(/Ã–/g, "Ã¶")
          .replace(/Ã‡/g, "Ã§")
          .toLowerCase();

      const capitalizeWords = (str) =>
        str
          .split(" ")
          .map((kelime) =>
            kelime.length > 0
              ? kelime[0].toUpperCase() + turkishToLower(kelime.slice(1))
              : ""
          )
          .join(" ");

      const formattedRest = capitalizeWords(rest.trim());
      return firstThree + formattedRest;
    }

    function dersEkle() {
      const container = document.getElementById("dersListesi");
      const div = document.createElement("div");
      div.className = "ders-item";
      div.innerHTML = `
        <label>AlÄ±nacak Dersin BÃ¶lÃ¼mÃ¼:</label>
        <select name="dersBolumu" required>
          <option>Matematik MÃ¼hendisliÄŸi</option>
          <option>Bilgisayar MÃ¼hendisliÄŸi</option>
          <option>EndÃ¼stri MÃ¼hendisliÄŸi</option>
          <option>Ä°ÅŸletme</option>
          <option>Ä°statistik</option>
        </select>

        <label>AlÄ±nacak Dersin Kodu-AdÄ±:</label>
        <input type="text" name="yeniDers" required />

        <label>AlÄ±nacak Dersin Grubu:</label>
        <input type="text" name="grup" required />

        <label>AlÄ±nacak Dersin Dili:</label>
        <select name="dili" required>
          <option value="Tr">TÃ¼rkÃ§e</option>
          <option value="Ä°ng">Ä°ngilizce</option>
        </select>

        <label>AlÄ±nacak Dersin Kredisi (T+U):</label>
        <input type="text" name="krediTu" required pattern="^\\d+\\+\\d+$" title="LÃ¼tfen T+U formatÄ±nda (Ã¶rneÄŸin 3+0) giriniz." />

        <label>EÅŸdeÄŸer Dersin Kodu-AdÄ±:</label>
        <input type="text" name="esKodAd" required />

        <label>EÅŸdeÄŸer Dili:</label>
        <input type="text" name="esDili" readonly />

        <label>EÅŸdeÄŸer Kredisi (T+U):</label>
        <input type="text" name="esKredi" required pattern="^\\d+\\+\\d+$" title="LÃ¼tfen T+U formatÄ±nda (Ã¶rneÄŸin 3+0) giriniz." />
      `;
      container.appendChild(div);

      const diliSelect = div.querySelector("select[name='dili']");
      const esDiliInput = div.querySelector("input[name='esDili']");
      esDiliInput.value = diliSelect.value === "Tr" ? "Tr" : "Ä°ng";
      diliSelect.addEventListener("change", function () {
        esDiliInput.value = this.value === "Tr" ? "Tr" : "Ä°ng";
      });
    }

    window.onload = () => dersEkle();

    document.getElementById("dilekceForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const ad = document.getElementById("ad").value;
      const soyad = document.getElementById("soyad").value;
      const numara = document.getElementById("numara").value;
      const email = document.getElementById("email").value;
      const telefon = document.getElementById("telefon").value;
      const kredi = document.getElementById("kredi").value;
      const bolum = document.getElementById("bolumSelect").value;
      const mazeret = document.getElementById("mazeret").value;

      const adSoyad = `${ad}_${soyad}`.replace(/\s+/g, "_");
      window.adSoyad = adSoyad;

      const today = new Date();
      const formattedDate = today.toLocaleDateString("tr-TR");

      const bilgiler = `<strong>Ad Soyad:</strong> ${ad} ${soyad}<br>
<strong>Ã–ÄŸrenci No:</strong> ${numara}<br>
<strong>E-posta:</strong> ${email}<br>
<strong>Telefon:</strong> ${telefon}<br><div style="margin-bottom:2cm;"></div>`;

      document.getElementById("ogrenciBilgileri").innerHTML = bilgiler;
      document.getElementById("bolumYazisi").innerText = bolum;
      document.getElementById("krediBilgisi").innerText = kredi;
      document.getElementById("tarihYeri").innerText = `Tarih: ${formattedDate}`;
      document.getElementById("mazeretMetni").innerText = mazeret;

      const tbody = document.querySelector("#dersTablosu tbody");
      tbody.innerHTML = "";

      const dersler = document.querySelectorAll(".ders-item");
      dersler.forEach((ders) => {
        const bolum = ders.querySelector("select[name='dersBolumu']").value;
        let yeniDers = ders.querySelector("input[name='yeniDers']").value;
        const grup = ders.querySelector("input[name='grup']").value;
        const dili = ders.querySelector("select[name='dili']").value;
        const krediTu = ders.querySelector("input[name='krediTu']").value;
        const esKodAd = ders.querySelector("input[name='esKodAd']").value;
        const esDili = ders.querySelector("input[name='esDili']").value;
        const esKredi = ders.querySelector("input[name='esKredi']").value;

        yeniDers = formatDersAdi(yeniDers);
        const esKodAdFormatted = formatDersAdi(esKodAd);

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${bolum}</td>
          <td>${yeniDers}</td>
          <td>${grup}</td>
          <td>${dili}</td>
          <td>${krediTu}</td>
          <td>${esKodAdFormatted}</td>
          <td>${esDili}</td>
          <td>${esKredi}</td>
        `;
        tbody.appendChild(row);
      });

      document.getElementById("dilekceOutput").style.display = "block";
      document.getElementById("downloadBtnDiv").style.display = "block";
    });

    document.getElementById("downloadBtn").addEventListener("click", function () {
      const element = document.getElementById("dilekceOutput");
      const opt = {
        margin: 0.5,
        filename: `${window.adSoyad}_dilekce.pdf`,
        image: { type: "jpeg", quality: 0.98 },
        html2canvas: { scale: 2, scrollX: 0, scrollY: 0 },
        jsPDF: { unit: "in", format: "a4", orientation: "portrait" }
      };
      html2pdf().set(opt).from(element).save();
    });
  </script>
</body>
</html>
